var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function l(e){e.forEach(t)}function o(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(t,n,l){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const l=t.subscribe(...n);return l.unsubscribe?()=>l.unsubscribe():l}(n,l))}function i(e){return null==e?"":e}function s(e,t,n=t){return e.set(n),t}function c(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function d(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function f(e){return document.createTextNode(e)}function p(){return f(" ")}function b(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function h(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function y(e,t){for(let n=0;n<e.options.length;n+=1){const l=e.options[n];if(l.__value===t)return void(l.selected=!0)}}function w(e,t,n){e.classList[n?"add":"remove"](t)}let v;function $(e){v=e}function k(e){(function(){if(!v)throw new Error("Function called outside component initialization");return v})().$$.on_mount.push(e)}const O=[],j=[],T=[],_=[],C=Promise.resolve();let x=!1;function S(){x||(x=!0,C.then(P))}function E(e){T.push(e)}let A=!1;const F=new Set;function P(){if(!A){A=!0;do{for(let e=0;e<O.length;e+=1){const t=O[e];$(t),N(t.$$)}for($(null),O.length=0;j.length;)j.pop()();for(let e=0;e<T.length;e+=1){const t=T[e];F.has(t)||(F.add(t),t())}T.length=0}while(O.length);for(;_.length;)_.pop()();x=!1,A=!1,F.clear()}}function N(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(E)}}const L=new Set;let I;function U(){I={r:0,c:[],p:I}}function q(){I.r||l(I.c),I=I.p}function z(e,t){e&&e.i&&(L.delete(e),e.i(t))}function G(e,t,n,l){if(e&&e.o){if(L.has(e))return;L.add(e),I.c.push((()=>{L.delete(e),l&&(n&&e.d(1),l())})),e.o(t)}}function M(e){e&&e.c()}function K(e,n,a,r){const{fragment:i,on_mount:s,on_destroy:c,after_update:u}=e.$$;i&&i.m(n,a),r||E((()=>{const n=s.map(t).filter(o);c?c.push(...n):l(n),e.$$.on_mount=[]})),u.forEach(E)}function R(e,t){const n=e.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,o,a,r,i,s,c=[-1]){const u=v;$(t);const m=t.$$={fragment:null,ctx:null,props:s,update:e,not_equal:i,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:o.context||[]),callbacks:n(),dirty:c,skip_bound:!1};let f=!1;if(m.ctx=a?a(t,o.props||{},((e,n,...l)=>{const o=l.length?l[0]:n;return m.ctx&&i(m.ctx[e],m.ctx[e]=o)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](o),f&&function(e,t){-1===e.$$.dirty[0]&&(O.push(e),S(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],m.update(),f=!0,l(m.before_update),m.fragment=!!r&&r(m.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);m.fragment&&m.fragment.l(e),e.forEach(d)}else m.fragment&&m.fragment.c();o.intro&&z(t.$$.fragment),K(t,o.target,o.anchor,o.customElement),P()}$(u)}class B{$destroy(){R(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W=[];function J(t,n=e){let l;const o=[];function r(e){if(a(t,e)&&(t=e,l)){const e=!W.length;for(let e=0;e<o.length;e+=1){const n=o[e];n[1](),W.push(n,t)}if(e){for(let e=0;e<W.length;e+=2)W[e][0](W[e+1]);W.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(a,i=e){const s=[a,i];return o.push(s),1===o.length&&(l=n(r)||e),a(t),()=>{const e=o.indexOf(s);-1!==e&&o.splice(e,1),0===o.length&&(l(),l=null)}}}}const Y=J({id:null,role:null,login:null,email:null,discord:null,username:null,children:[]}),H=J("/");function Q(e="/",t="id",n){const l=e.substring(1)||"table";window.history.pushState(l,l,e),n&&(window.location.search="?"+t+"="+n),H.set(e)}const V=J({});function X(){let e,t=!1;V.subscribe((t=>e=t));for(const n in e)if("manager"===e[n]){t=!0;break}return t}function Z(){let e,t=!1;V.subscribe((t=>e=t));for(const n in e)if("manager"===e[n]||"user"===e[n]){t=!0;break}return t}const ee=J({init:"test"});function te(t){let n,l,o,a,r=(t[1]||t[0])+"";return{c(){n=m("div"),l=f(r),g(n,"class","link-button svelte-os0ae7"),w(n,"current",t[2])},m(e,r){u(e,n,r),c(n,l),o||(a=b(n,"click",t[3]),o=!0)},p(e,[t]){3&t&&r!==(r=(e[1]||e[0])+"")&&h(l,r),4&t&&w(n,"current",e[2])},i:e,o:e,d(e){e&&d(n),o=!1,a()}}}function ne(e,t,n){let{to:l}=t,{label:o=l}=t,a=!1;return H.subscribe((e=>{e.substring(1)===l?n(2,a=!0):n(2,a=!1)})),e.$$set=e=>{"to"in e&&n(0,l=e.to),"label"in e&&n(1,o=e.label)},[l,o,a,function(){n(2,a=!a),Q("/"+l)}]}class le extends B{constructor(e){super(),D(this,e,ne,te,a,{to:0,label:1})}}if("localhost"===window.location.hostname)var oe=window.location.protocol+"//localhost:8000/api/";else oe=window.location.protocol+"//reputation.vpluseteam.com/api/";const ae={owner:"владелец",manager:"менеджер",user:"обычный пользователь",readonly:"только чтение"};function re(e){let t,n,l,o,a,r,i,s,c,f="root"===e[0].role||X();t=new le({props:{label:"Таблица",to:""}});let h=f&&se();return o=new le({props:{to:"settings",label:"Профиль"}}),{c(){M(t.$$.fragment),n=p(),h&&h.c(),l=p(),M(o.$$.fragment),a=p(),r=m("div"),r.textContent="Выйти",g(r,"class","link-button svelte-dqos1q")},m(d,m){K(t,d,m),u(d,n,m),h&&h.m(d,m),u(d,l,m),K(o,d,m),u(d,a,m),u(d,r,m),i=!0,s||(c=b(r,"click",e[1]),s=!0)},p(e,t){1&t&&(f="root"===e[0].role||X()),f?h?1&t&&z(h,1):(h=se(),h.c(),z(h,1),h.m(l.parentNode,l)):h&&(U(),G(h,1,1,(()=>{h=null})),q())},i(e){i||(z(t.$$.fragment,e),z(h),z(o.$$.fragment,e),i=!0)},o(e){G(t.$$.fragment,e),G(h),G(o.$$.fragment,e),i=!1},d(e){R(t,e),e&&d(n),h&&h.d(e),e&&d(l),R(o,e),e&&d(a),e&&d(r),s=!1,c()}}}function ie(t){let n,l;return n=new le({props:{to:"login",label:"Логин"}}),{c(){M(n.$$.fragment)},m(e,t){K(n,e,t),l=!0},p:e,i(e){l||(z(n.$$.fragment,e),l=!0)},o(e){G(n.$$.fragment,e),l=!1},d(e){R(n,e)}}}function se(e){let t,n,l,o;return t=new le({props:{to:"funds",label:"Фонды"}}),l=new le({props:{to:"users",label:"Пользователи"}}),{c(){M(t.$$.fragment),n=p(),M(l.$$.fragment)},m(e,a){K(t,e,a),u(e,n,a),K(l,e,a),o=!0},i(e){o||(z(t.$$.fragment,e),z(l.$$.fragment,e),o=!0)},o(e){G(t.$$.fragment,e),G(l.$$.fragment,e),o=!1},d(e){R(t,e),e&&d(n),R(l,e)}}}function ce(e){let t,n,l,o;const a=[ie,re],r=[];function i(e,t){return e[0].role?1:0}return n=i(e),l=r[n]=a[n](e),{c(){t=m("nav"),l.c(),g(t,"class","svelte-dqos1q")},m(e,l){u(e,t,l),r[n].m(t,null),o=!0},p(e,[o]){let s=n;n=i(e),n===s?r[n].p(e,o):(U(),G(r[s],1,1,(()=>{r[s]=null})),q(),l=r[n],l?l.p(e,o):(l=r[n]=a[n](e),l.c()),z(l,1),l.m(t,null))},i(e){o||(z(l),o=!0)},o(e){G(l),o=!1},d(e){e&&d(t),r[n].d()}}}function ue(e,t,n){let l,o;return r(e,Y,(e=>n(0,l=e))),r(e,V,(e=>n(2,o=e))),[l,async function(){"OK"===(await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"auth/logout",e)).json()}catch(e){return e}})()).status&&(s(Y,l={children:[]},l),s(V,o={},o),Q("/login","a","a"))}]}class de extends B{constructor(e){super(),D(this,e,ue,ce,a,{})}}const me=async(e,t,n)=>{const l={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({userId:e,role:t,fundId:n})};try{const e=await fetch(oe+"funds/addUser",l);return e.json()}catch(e){return e}},fe={title:"Создание фонда",fields:{name:{label:"Название",required:!0},email:{label:"E-mail",type:"email",rules:[e=>0==Boolean(e)||Boolean(e.includes("@")&&e.includes("."))||"неверный формат e-mail"]},skype:{label:"Skype"},site:{label:"Сайт"},discord:{label:"Сервер discord"},msg:{type:"html",value:"",service:!0}},methods:{async onSubmit(e,t,n){let l;Y.subscribe((e=>l=e.id));const o={owner:l};for(const[e,t]of Object.entries(n))""!==t&&(o[e]=t);const a=await async function(e={}){const t={method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({...e})};try{return(await fetch(oe+"funds/create",t)).json()}catch(e){return e}}(o);e.fields.msg.value=a.msg,"OK"===a.status&&ee.update((e=>({...e,[a.data.fund.id]:n.name})))}},buttons:{submit:{label:"отправить",color:"primary"}}};function pe(t){let n;return{c(){n=m("main"),n.innerHTML='<div id="createGroupForm"></div>'},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function be(e){return k((()=>{window.callForm2("#createGroupForm",{},fe)})),[]}class ge extends B{constructor(e){super(),D(this,e,be,pe,a,{})}}function he(t){let n;return{c(){n=m("main"),n.innerHTML='<div id="loginForm"></div>'},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function ye(e,t,n){let l;r(e,Y,(e=>n(0,l=e)));const o={fields:{credential:{label:"Логин, email или ник discord",type:"email"},password:{label:"Пароль",type:"password"},message:{type:"html",value:""}},methods:{async onSubmit(e,t,n,o){const a=await(async(e,t)=>{const n={method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({credential:e,password:t})};try{return(await fetch(oe+"auth/login/",n)).json()}catch(e){return e}})(n.credential,n.password);"OK"===a.status?(s(Y,l=a.data.user,l),a.data.userProps?.funds&&V.set(a.data.userProps.funds),a.data.userProps?.children&&s(Y,l.children=a.data.userProps.children,l),e.fields.message.value=a.msg,setTimeout((()=>{Q("/")}),500)):e.fields.message.value=a.msg||"Неизвестная ошибка, проверьте подключение"}}};return k((()=>{window.callForm2("#loginForm",{},o)})),[]}class we extends B{constructor(e){super(),D(this,e,ye,he,a,{})}}function ve(t){let n,l,o,a,r=(t[1]||t[0])+"";return{c(){n=m("button"),l=f(r),g(n,"class","link-button ui button svelte-m74toc"),w(n,"current",t[2])},m(e,r){u(e,n,r),c(n,l),o||(a=b(n,"click",t[3]),o=!0)},p(e,[t]){3&t&&r!==(r=(e[1]||e[0])+"")&&h(l,r),4&t&&w(n,"current",e[2])},i:e,o:e,d(e){e&&d(n),o=!1,a()}}}function $e(e,t,n){let{to:l}=t,{label:o=l}=t,a=!1;return H.subscribe((e=>{e.substring(1)===l?n(2,a=!0):n(2,a=!1)})),e.$$set=e=>{"to"in e&&n(0,l=e.to),"label"in e&&n(1,o=e.label)},[l,o,a,function(){n(2,a=!a),Q("/"+l)}]}class ke extends B{constructor(e){super(),D(this,e,$e,ve,a,{to:0,label:1})}}function Oe(e,t,n){const l=e.slice();return l[15]=t[n],l}function je(e){let t,n,l;return{c(){t=f(e[0]),n=p(),l=m("br")},m(e,o){u(e,t,o),u(e,n,o),u(e,l,o)},p(e,n){1&n&&h(t,e[0])},d(e){e&&d(t),e&&d(n),e&&d(l)}}}function Te(e){let t,n,l,o,a=e[15].name+"";return{c(){t=m("option"),n=f(a),l=p(),t.__value=o=e[15].id,t.value=t.__value,g(t,"class","item svelte-1in54i1")},m(e,o){u(e,t,o),c(t,n),c(t,l)},p(e,l){4&l&&a!==(a=e[15].name+"")&&h(n,a),4&l&&o!==(o=e[15].id)&&(t.__value=o,t.value=t.__value)},d(e){e&&d(t)}}}function _e(e){let t,n,l;return n=new ke({props:{to:"createNote",label:"Создать запись"}}),{c(){t=m("div"),M(n.$$.fragment),g(t,"class","createContainer item svelte-1in54i1")},m(e,o){u(e,t,o),K(n,t,null),l=!0},i(e){l||(z(n.$$.fragment,e),l=!0)},o(e){G(n.$$.fragment,e),l=!1},d(e){e&&d(t),R(n)}}}function Ce(e){let t,n,o,a,r,i,s,f,h,w,v,$,k,O,j,T,_,C,x="root"===e[3].role||Z(),S=e[0]&&je(e),A=e[2],F=[];for(let t=0;t<A.length;t+=1)F[t]=Te(Oe(e,A,t));let P=x&&_e();return{c(){t=m("main"),S&&S.c(),n=p(),o=m("div"),a=m("div"),r=m("select");for(let e=0;e<F.length;e+=1)F[e].c();i=p(),s=m("div"),f=m("input"),h=p(),w=m("i"),v=p(),P&&P.c(),$=p(),k=m("div"),O=p(),j=m("div"),g(r,"class","item svelte-1in54i1"),void 0===e[1]&&E((()=>e[6].call(r))),g(f,"type","text"),g(f,"placeholder","Поиск записей"),g(f,"class","svelte-1in54i1"),g(w,"class","search link icon"),g(s,"class","ui icon input item svelte-1in54i1"),g(a,"class","userControls inline ui input svelte-1in54i1"),g(o,"class","tableControls"),g(k,"id","tableMountingPoint"),g(j,"id","modalPoint")},m(l,d){u(l,t,d),S&&S.m(t,null),c(t,n),c(t,o),c(o,a),c(a,r);for(let e=0;e<F.length;e+=1)F[e].m(r,null);y(r,e[1]),c(a,i),c(a,s),c(s,f),c(s,h),c(s,w),c(a,v),P&&P.m(a,null),c(t,$),c(t,k),c(t,O),c(t,j),T=!0,_||(C=[b(r,"change",e[6]),b(r,"change",e[5]),b(f,"input",e[4])],_=!0)},p(e,[l]){if(e[0]?S?S.p(e,l):(S=je(e),S.c(),S.m(t,n)):S&&(S.d(1),S=null),4&l){let t;for(A=e[2],t=0;t<A.length;t+=1){const n=Oe(e,A,t);F[t]?F[t].p(n,l):(F[t]=Te(n),F[t].c(),F[t].m(r,null))}for(;t<F.length;t+=1)F[t].d(1);F.length=A.length}6&l&&y(r,e[1]),8&l&&(x="root"===e[3].role||Z()),x?P?8&l&&z(P,1):(P=_e(),P.c(),z(P,1),P.m(a,null)):P&&(U(),G(P,1,1,(()=>{P=null})),q())},i(e){T||(z(P),T=!0)},o(e){G(P),T=!1},d(e){e&&d(t),S&&S.d(),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(F,e),P&&P.d(),_=!1,l(C)}}}function xe(e,t,n){let l,o,a,i;r(e,Y,(e=>n(3,o=e))),r(e,V,(e=>n(9,a=e))),r(e,ee,(e=>n(10,i=e)));let s,c="",u="",d="";async function m(){const e=await(async(e,t="desc")=>{const n={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(e?await fetch(oe+"table?id="+e+"&order="+t,n):await fetch(oe+"table",n)).json()}catch(e){return e}})(undefined,"desc");return"OK"!==e.status?n(0,c=e.msg||e):e}function f(e=[],t){const n=e=>{const{field:t}=e._cell.column,n=e._cell.row.data[t].join(", "),l=document.createElement("div");return l.title=n,l.innerText=n,l},r=(e,t)=>({title:t,field:e,formatter:n,headerSort:!1});new Tabulator("#tableMountingPoint",{data:e,pagination:"remote",paginationSize:25,paginationSizeSelector:[10,25,50,100],ajaxURL:oe+"table",ajaxSorting:!0,ajaxParams:{where:u,author:d},columnMaxWidth:300,dataTree:!0,headerSort:!1,columns:[{title:"<div class='editColumnTitle'></div>",field:"id",frozen:!0,minWidth:0,width:66,formatter(e){const t=e._cell.row.data.id,n=e._cell.row.data.author,r=document.createElement("a");if(r.className="linkToRow material-icons notranslate",r.innerText="create",r.style.textDecoration="none",e._cell.row.data.parent&&"root"===o.role)return r.href="./editNote?id="+t+"&parent="+e._cell.row.data.parent,r;if("root"===o.role||a[n]&&"readonly"!==a[n]&&!e._cell.row.data.parent)return r.href="./editNote?id="+t,r;const s=document.createElement("i");return s.className="linkToRow material-icons notranslate",s.innerText="visibility",s.addEventListener("click",(()=>{!function(e,t){const n={modal:!0,fields:{author:{label:"Автор",type:"select",options:l,readonly:!0,value:i[e]},case:{label:"Арбитраж",type:"multiple",value:[],settings:{arbitrage:{label:"Арбитраж",row:1},descr:{label:"Описание",type:"textarea",row:1},amount:{label:"Размер",row:1}},visible:t.case.length},nicknameOld:{label:"Архивные дицсциплины и никнеймы",type:"textarea",visible:t.nicknameOld},nickname:{label:"Дисциплины",type:"multiple",value:[],settings:{discipline:{label:"Дисциплина",row:1},room:{label:"Room",row:1},value:{label:"Nick",row:1}},visible:t.nickname.length},FIO:{label:"ФИО",type:"multiple",value:[],settings:{firstname:{label:"Имя",row:1},lastname:{label:"Фамилия",row:1},middlename:{label:"Отчество",row:1}},visible:t.FIO.length},gipsyteam:{label:"Gipsy team",type:"creatable",outlined:!0,visible:t.gipsyteam.length},skype:{label:"Аккаунты Skype",type:"creatable",outlined:!0,visible:t.skype.length},skrill:{label:"Аккаунты skrill",type:"creatable",outlined:!0,visible:t.skrill.length},neteller:{label:"Аккаунты neteller",type:"creatable",outlined:!0,visible:t.neteller.length},phone:{label:"Телефоны",type:"creatable",outlined:!0,visible:t.phone.length},pokerstrategy:{label:"Poker Strategy",type:"creatable",outlined:!0,visible:t.pokerstrategy.length},google:{label:"Google аккаунты",type:"creatable",outlined:!0,visible:t.google.length},mail:{label:"Адреса e-mail",type:"creatable",outlined:!0,visible:t.mail.length},vk:{label:"Аккаунты vkontakte",type:"creatable",outlined:!0,visible:t.vk.length},facebook:{label:"Аккаунты facebook",type:"creatable",outlined:!0,visible:t.facebook.length},blog:{label:"Блоги",type:"creatable",outlined:!0,visible:t.blog.length},instagram:{label:"Аккаунты instagram",type:"creatable",outlined:!0,visible:t.instagram.length},forum:{label:"Форумы",type:"creatable",outlined:!0,visible:t.forum.length},ecopayz:{label:"Аккаунты ecopayz",type:"creatable",outlined:!0,visible:t.ecopayz.length},location:{label:"Адреса",type:"multiple",value:[],settings:{country:{label:"Страна",row:1},town:{label:"Город",row:1},address:{label:"Адрес",row:1}},visible:t.location.length},webmoney:{label:"Аккаунты Webmoney",type:"multiple",value:[],settings:{WMID:{row:1,label:"WMID",required:!0},wallets:{label:"Кошельки",type:"creatable",row:1}},visible:t.webmoney.length},comments:{label:"Комментарии",type:"textarea",visible:t.comments}},title:"Просмотр записи",buttons:null,noButtons:!0,global:{fields:{readonly:!0}}};window.callForm2("#modalPoint",t,n)}(t,e._cell.row.data)})),s},headerSort:!1},{title:"Фонд",field:"author",headerSort:!1,formatter:e=>{const t=e._cell.row.data.author;return i[t]}},{title:"Создано",field:"created",formatter:e=>e._cell.row.data.old?"архив":moment(e._cell.row.data.created).format("MM-DD-YYYY"),headerSort:!0},{title:"Обновлено",field:"updated",formatter:e=>e._cell.row.data.old?"архив":moment(e._cell.row.data.updated).format("MM-DD-YYYY"),headerSort:!0},{title:"Автор",field:"fundName",visible:!1,sorter:"string"},{title:"Арбитраж",field:"case",width:150,headerSort:!1,formatter(e,t,n){const l=e._cell.row.data.case.map((e=>e.arbitrage)).join(", "),o=document.createElement("div");return o.title=l,o.innerText=l,o},sorter:"string"},{title:"Ники",field:"nickname",width:350,headerSort:!1,formatter(e){const t=e._cell.row.data.nickname.map((t=>e._cell.row.data.old?e._cell.row.data.nicknameOld:t.room?t.room+(t.value&&" - "+t.value):t.value)).join(", "),n=document.createElement("div");return n.title=t,n.innerText=t,n}},{title:"Дисциплина",field:"nickname",width:150,headerSort:!1,formatter:(e,t,n)=>e._cell.row.data.nickname.map((e=>e.discipline)).join(", "),sorter:"string"},{title:"ФИО",field:"FIO",width:250,headerSort:!1,formatter:(e,t,n)=>e._cell.row.data.FIO.map((e=>(e.lastname||"")+" "+(e.firstname||"")+" "+(e.middlename||""))).join(", ")},{title:"Описание",field:"case",width:250,headerSort:!1,formatter(e,t,n){const l=e._cell.row.data.case.map((e=>e.descr)).join(" | "),o=document.createElement("div");return o.title=l,o.innerText=l,o},sorter:"string"},{title:"Ущерб ($)",field:"case",width:100,headerSort:!1,formatter(e,t,n){const l=e._cell.row.data.case.map((e=>e.amount)).join(" | "),o=document.createElement("div");return o.title=l,o.innerText=l,o},sorter:"string"},r("gipsyteam","Gipsy team"),r("skype","Skype"),r("skrill","Skrill"),r("neteller","Neteller"),r("phone","Телефоны"),{title:"Адреса",field:"location",headerSort:!1,formatter:(e,t,n)=>e._cell.row.data.location.map((e=>e.country+" "+e.town+" "+e.address)).join(" ,")},r("pokerstrategy","Poker Strategy"),r("google","Google"),r("mail","e-mail"),r("vk","Вконтакте"),r("facebook","Facebook"),r("blog","Блог"),r("forum","Форум"),r("instagram","Instagram"),r("ecopayz","Ecopayz"),{title:"Webmoney",field:"webmoney",headerSort:!1,formatter:(e,t,n)=>e._cell.row.data.webmoney.map((e=>{const t=e.wallets&&Array.isArray(e.wallets)&&e.wallets.join(" ,");return e.WMID+": "+t})).join(" | ")},{title:"Комментарии",field:"comments",headerSort:!1}],locale:!0,langs:{"en-gb":{columns:{},ajax:{loading:"Loading",error:"Error"},groups:{item:"item",items:"items"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All"},headerFilters:{default:"filter column...",columns:{column:"filter name..."}},custom:{}},"ru-ru":{columns:{},ajax:{loading:"Загрузка...",error:"Ошибка!"},groups:{item:"свойство",items:"свойства"},pagination:{page_size:"Кол-во строк",page_title:"Показать страницу",first:"Первая",first_title:"Первая страница",last:"Последняя",last_title:"Последняя страница",prev:"Пред.",prev_title:"Предыдущая страница",next:"След.",next_title:"Следущая страница",all:"Всё"},headerFilters:{default:"Отфильтровать...",columns:{}},custom:{}}},tableBuilt(){document.querySelector(".tabulator").classList.add("compact","very"),this.redraw(!0)}})}return k((async()=>{const e=await m();e&&f(e.data,e.last_page);const t=[{id:"",name:"Все фонды"}];Object.entries(i).forEach((([e,n])=>t.push({id:e,name:n}))),n(2,l=t)})),n(2,l=[]),[c,d,l,o,async function(e){let t=e.target.value;clearTimeout(s),s=setTimeout((()=>{u=t,f()}),500)},function(e){f()},function(){d=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(1,d),n(2,l)}]}class Se extends B{constructor(e){super(),D(this,e,xe,Ce,a,{})}}const Ee=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({...e})};try{const e=await fetch(oe+"users/create/",t);return e.json()}catch(e){return e}};async function Ae(e,t){let n=[];if("root"===e.role){const e=await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"users/all",e)).json()}catch(e){return e}})();return"OK"===e.status?(n=e.data,[n]):[n,e.msg||e]}if(e.children?.length){const e=await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"users/children",e)).json()}catch(e){return e}})();if("OK"!==e.status||!e.data.length)return[null,e.msg||e];n=[...n,...e.data]}return[n.filter(((e,t,n)=>n.findIndex((t=>t.id===e.id))===t)).filter((e=>"root"!==e.role))]}function Fe(e){let t,n,l;return n=new ke({props:{to:"createUser",label:"Создать пользователя"}}),{c(){t=m("div"),M(n.$$.fragment),g(t,"class","createContainer svelte-12b68td")},m(e,o){u(e,t,o),K(n,t,null),l=!0},i(e){l||(z(n.$$.fragment,e),l=!0)},o(e){G(n.$$.fragment,e),l=!1},d(e){e&&d(t),R(n)}}}function Pe(e){let t,n,l,o,a,r,i,s,f,h,y,w="root"===e[0].role||X(),v=w&&Fe();return{c(){t=m("div"),n=m("div"),l=m("input"),o=p(),a=m("i"),r=p(),v&&v.c(),i=p(),s=m("div"),g(l,"type","text"),g(l,"placeholder","Поиск пользователей"),g(l,"class","svelte-12b68td"),g(a,"class","search link icon"),g(n,"class","ui icon input item"),g(t,"class","userControls inline svelte-12b68td"),g(s,"id","tableMountingPoint")},m(d,m){u(d,t,m),c(t,n),c(n,l),c(n,o),c(n,a),c(t,r),v&&v.m(t,null),u(d,i,m),u(d,s,m),f=!0,h||(y=b(l,"input",e[1]),h=!0)},p(e,[n]){1&n&&(w="root"===e[0].role||X()),w?v?1&n&&z(v,1):(v=Fe(),v.c(),z(v,1),v.m(t,null)):v&&(U(),G(v,1,1,(()=>{v=null})),q())},i(e){f||(z(v),f=!0)},o(e){G(v),f=!1},d(e){e&&d(t),v&&v.d(),e&&d(i),e&&d(s),h=!1,y()}}}function Ne(e,t,n){let l,o,a,i,s;r(e,ee,(e=>n(5,l=e))),r(e,Y,(e=>n(0,o=e))),r(e,V,(e=>n(6,e)));let c=l;function u(){a.length&&new window.Tabulator("#tableMountingPoint",{data:a,layout:"fitDataTable",pagination:"local",paginationSize:25,columns:[{title:" ",formatter(e){const t=e._cell.row.data.userProps.id,n=document.createElement("i");return n.className="linkToRow",n.addEventListener("click",(()=>Q("/editUser","id",t))),n.innerText="править",n}},{title:"Имя пользователя",field:"username",sorter:"string"},{title:"Логин",field:"login",sorter:"string"},{title:"Ник discord",field:"discord",sorter:"string"},{title:"E-mail",field:"email",sorter:"string"},{title:"Фонды",field:"groups",formatter(e){const t=e._cell.row.data.userProps.funds;if(!t)return"";const n=[];return Object.entries(t).forEach((([e,t])=>{n.push(c[e]+" - "+ae[t])})),n.length?n.join(", "):""}}]})}return k((async()=>{[a,s]=await Ae(o),i=[...a],a&&u()})),[o,function(e){let t=e.target.value;if(a){if(t.length)return t=t.toLocaleLowerCase(),a=i.filter((e=>{let{username:n,email:l,discord:o,login:a,funds:r}=e;return!(!n||!n.toLocaleLowerCase().includes(t))||(!(!l||!l.toLocaleLowerCase().includes(t))||(!(!o||!o.toLocaleLowerCase().includes(t))||(!(!a||!a.toLocaleLowerCase().includes(t))||void 0)))})),u();a=i,u()}}]}class Le extends B{constructor(e){super(),D(this,e,Ne,Pe,a,{})}}function Ie(t){let n;return{c(){n=m("div"),n.innerHTML='<div id="createUserForm"></div>'},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function Ue(e,t,n){let l;r(e,Y,(e=>n(0,l=e)));const o=[{id:"guest",name:"Обычный"}];"root"===l.role&&o.unshift({id:"root",name:"root"});const a={fields:{name:{label:"Имя пользователя",hint:"Как к вам обращаться"},login:{label:"Логин"},discord:{label:"Ник discord"},email:{label:"E-mail",type:"email",rules:[e=>0==e||Boolean(e.includes("@")&&e.includes("."))||"неверный формат e-mail"]},password:{label:"Пароль",type:"password",required:!0,rules:[e=>e.length>5||"введите минимум 6 символов"]},role:{label:"Роль",type:"select",autocomplete:!1,options:o,value:"guest",visible:o.length>1},message:{type:"html",value:"",service:!0}},methods:{async onSubmit(e,t,n){if(!n.login&&!n.discord&&!n.email)return e.fields.message.value="Введите логин, или discord или email";const o={};for(const[e,t]of Object.entries(n))""!==t&&(o[e]=t);const a=await Ee(o);var r;e.fields.message.value=a.msg||"Неизвестная ошибка, проверьте подключение","OK"===a.status&&(r=a.data.id,l.children.push(r))}},title:"Создать пользователя"};return k((()=>{window.callForm2("#createUserForm",{},a)})),[]}class qe extends B{constructor(e){super(),D(this,e,Ue,Ie,a,{})}}function ze(t){let n,l,o;return{c(){n=m("div"),l=p(),o=f(t[0]),g(n,"id","formEditUser")},m(e,t){u(e,n,t),u(e,l,t),u(e,o,t)},p(e,[t]){1&t&&h(o,e[0])},i:e,o:e,d(e){e&&d(n),e&&d(l),e&&d(o)}}}function Ge(e,t,n){let l;r(e,Y,(e=>n(2,l=e)));const o=new URLSearchParams(window.location.search).get("id");let a,i="",s=l;async function c(){const e=await(async e=>{const t={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"users/fullInfo?id="+e,t)).json()}catch(e){return e}})(o);"OK"===e.status?(a=e.data,function(){const e=[{id:"guest",name:"Обычный"}];"root"===s.role&&e.unshift({id:"root",name:"root"});const t={fields:{username:{label:"Имя пользователя"},login:{label:"Логин"},discord:{label:"Ник discord"},email:{label:"E-mail",type:"email"},role:{label:"Роль",key:"",type:"select",autocomplete:!1,options:e,value:"guest",visible:"root"===s.role},password:{label:"Задать новый пароль",type:"password",rules:[e=>0==Boolean(e)||e.length>5||"введите минимум 6 символов"]},msg:{type:"html",value:"",service:!0}},methods:{async onSubmit(e,t,n){if(!n.login&&!n.discord&&!n.email)return void(e.fields.msg.value="Введите логин, или discord или email");e.fields.msg.value="";const l={};for(const[e,t]of Object.entries(n))""!==t&&(l[e]=t);const a=await(async(e,t)=>{const n={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({...t,id:e})};try{return(await fetch(oe+"users/updateAnoterUser",n)).json()}catch(e){return e}})(o,l);e.fields.msg.value=a.msg}}};window.callForm2("#formEditUser",{...a},t)}()):n(0,i=e.msg||e)}return k((async()=>{c()})),[i]}class Me extends B{constructor(e){super(),D(this,e,Ge,ze,a,{})}}function Ke(e){let t,n,l;return n=new ke({props:{to:"createUser",label:"Создать фонд"}}),{c(){t=m("div"),M(n.$$.fragment),g(t,"class","createContainer svelte-1ocrjsp")},m(e,o){u(e,t,o),K(n,t,null),l=!0},i(e){l||(z(n.$$.fragment,e),l=!0)},o(e){G(n.$$.fragment,e),l=!1},d(e){e&&d(t),R(n)}}}function Re(e){let t,n,l,o,a,r,i,s,y,w,v,$,k,O="root"===e[1].role&&Ke();return{c(){t=m("div"),n=m("div"),l=m("input"),o=p(),a=m("i"),r=p(),O&&O.c(),i=p(),s=m("div"),y=p(),w=f(e[0]),g(l,"type","text"),g(l,"placeholder","Поиск фондов"),g(l,"class","svelte-1ocrjsp"),g(a,"class","search link icon"),g(n,"class","ui icon input item"),g(t,"class","fundControls inline svelte-1ocrjsp"),g(s,"id","tableMountingPoint")},m(d,m){u(d,t,m),c(t,n),c(n,l),c(n,o),c(n,a),c(t,r),O&&O.m(t,null),u(d,i,m),u(d,s,m),u(d,y,m),u(d,w,m),v=!0,$||(k=b(l,"input",e[2]),$=!0)},p(e,[n]){"root"===e[1].role?O?2&n&&z(O,1):(O=Ke(),O.c(),z(O,1),O.m(t,null)):O&&(U(),G(O,1,1,(()=>{O=null})),q()),(!v||1&n)&&h(w,e[0])},i(e){v||(z(O),v=!0)},o(e){G(O),v=!1},d(e){e&&d(t),O&&O.d(),e&&d(i),e&&d(s),e&&d(y),e&&d(w),$=!1,k()}}}function De(e,t,n){let l,o,a;r(e,ee,(e=>n(5,e))),r(e,Y,(e=>n(1,l=e)));let i="";function s(){new window.Tabulator("#tableMountingPoint",{layout:"fitDataTable",data:o,pagination:"local",paginationSize:25,columns:[{title:"",field:"id",formatter(e){const t=e._cell.row.data.id,n=document.createElement("i");return n.className="linkToRow",n.addEventListener("click",(()=>Q("/editFund","id",t))),n.innerText="править",n}},{title:"Название",field:"name",sorter:"string"},{title:"Discord",field:"discord",sorter:"string"},{title:"Сайт",field:"site",sorter:"string"}]})}return k((async()=>{const e=await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"funds/getFunds",e)).json()}catch(e){return e}})();"OK"===e.status?(o=e.data,a=[...e.data],s()):n(0,i=e.msg||e)})),[i,l,function(e){let t=e.target.value;if(o){if(t.length)return t=t.toLocaleLowerCase(),o=a.filter((e=>{let{name:n,site:l,discord:o}=e;return!(!n||!n.toLocaleLowerCase().includes(t))||(!(!l||!l.toLocaleLowerCase().includes(t))||(!(!o||!o.toLocaleLowerCase().includes(t))||void 0))})),s();o=a,s()}}]}class Be extends B{constructor(e){super(),D(this,e,De,Re,a,{})}}function We(e){let t,n,l,o=e[2]?.name+"";return{c(){t=m("h5"),n=f("Фонд "),l=f(o),g(t,"class"," svelte-lk7h0r")},m(e,o){u(e,t,o),c(t,n),c(t,l)},p(e,t){4&t&&o!==(o=e[2]?.name+"")&&h(l,o)},d(e){e&&d(t)}}}function Je(e){let t,n,l;return{c(){t=f(e[1]),n=p(),l=m("br")},m(e,o){u(e,t,o),u(e,n,o),u(e,l,o)},p(e,n){2&n&&h(t,e[1])},d(e){e&&d(t),e&&d(n),e&&d(l)}}}function Ye(e){let t,n,l;return{c(){t=m("div"),n=p(),l=m("div"),g(t,"id","usersTable"),g(l,"id","userEditor")},m(e,o){u(e,t,o),u(e,n,o),u(e,l,o)},d(e){e&&d(t),e&&d(n),e&&d(l)}}}function He(e){let t,n,l;return{c(){t=m("div"),n=p(),l=m("div"),g(t,"id","addUsersForm"),g(l,"id","regAndAddUsersForm")},m(e,o){u(e,t,o),u(e,n,o),u(e,l,o)},d(e){e&&d(t),e&&d(n),e&&d(l)}}}function Qe(e){let t;return{c(){t=m("div"),g(t,"id","editGroupForm")},m(e,n){u(e,t,n)},d(e){e&&d(t)}}}function Ve(t){let n,o,a,r,s,h,y,w,v,$,k,O,j,T,_,C,x,S,E=t[2]&&We(t),A=t[1]&&Je(t);function F(e,t){return 0===e[0]?Qe:1===e[0]?He:2===e[0]?Ye:void 0}let P=F(t),N=P&&P(t);return{c(){n=m("main"),E&&E.c(),o=p(),a=m("div"),r=m("div"),s=f("Общая информация"),y=p(),w=m("div"),v=f("Добавить участников"),k=p(),O=m("div"),j=f("Редактировать участников"),_=p(),A&&A.c(),C=p(),N&&N.c(),g(r,"class",h=i(0===t[0]?"current":"link-button")+" svelte-lk7h0r"),g(w,"class",$=i(1===t[0]?"current":"link-button")+" svelte-lk7h0r"),g(O,"class",T=i(2===t[0]?"current":"link-button")+" svelte-lk7h0r"),g(a,"class","navigation svelte-lk7h0r")},m(e,l){u(e,n,l),E&&E.m(n,null),c(n,o),c(n,a),c(a,r),c(r,s),c(a,y),c(a,w),c(w,v),c(a,k),c(a,O),c(O,j),c(n,_),A&&A.m(n,null),c(n,C),N&&N.m(n,null),x||(S=[b(r,"click",t[4]),b(w,"click",t[5]),b(O,"click",t[6])],x=!0)},p(e,[t]){e[2]?E?E.p(e,t):(E=We(e),E.c(),E.m(n,o)):E&&(E.d(1),E=null),1&t&&h!==(h=i(0===e[0]?"current":"link-button")+" svelte-lk7h0r")&&g(r,"class",h),1&t&&$!==($=i(1===e[0]?"current":"link-button")+" svelte-lk7h0r")&&g(w,"class",$),1&t&&T!==(T=i(2===e[0]?"current":"link-button")+" svelte-lk7h0r")&&g(O,"class",T),e[1]?A?A.p(e,t):(A=Je(e),A.c(),A.m(n,C)):A&&(A.d(1),A=null),P!==(P=F(e))&&(N&&N.d(1),N=P&&P(e),N&&(N.c(),N.m(n,null)))},i:e,o:e,d(e){e&&d(n),E&&E.d(),A&&A.d(),N&&N.d(),x=!1,l(S)}}}function Xe(e,t,n){let l;r(e,Y,(e=>n(11,l=e)));const o=new URLSearchParams(window.location.search).get("id");let a,i=0,s="",c=[{label:"Менеджер",value:"manager"},{label:"Обычный пользователь",value:"user"},{label:"Только чтение",value:"readonly"}];const u={};let d,m,f,p=[];function b(){const e={fields:{name:{label:"Название",required:!0},email:{label:"E-mail",type:"email"},skype:{label:"Skype"},site:{label:"Сайт"},discord:{label:"Сервер discord"},owner:{label:"Создатель",hint:"Начните вводить имя",options:p,type:"select",onInput(e,t,n){const l=e.fields.owner.options.find((e=>e.id===n));d=l}},msg:{type:"html",value:""}},methods:{async onSubmit(e,t,l){if(l.owner&&l.owner!==a.owner.value){const t=await(async(e,t,n)=>{const l={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({fundId:e,ownerId:t,prevOwnerId:n})};try{return(await fetch(oe+"funds/updateOwner",l)).json()}catch(e){return e}})(a.id,l.owner,a.owner.value);"OK"===t.status&&(n(2,a.owner=d,a),d=null,u[l.owner]="owner",u[a.owner.value]&&delete u[a.owner.value]),e.fields.msg.value=t.msg||t}const o={};for(const[e,t]of Object.entries(l))""!==t&&"owner"!==e&&(o[e]=t);const r=await(async(e,t)=>{const n={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({fundId:e,data:t})};try{return(await fetch(oe+"funds/updateForm",n)).json()}catch(e){return e}})(a.id,o);"OK"===r.status&&(delete l.owner,n(2,a={...a,...l})),e.fields.msg.value=r.msg}}};window.callForm2("#editGroupForm",{...a,owner:a.owner.value},e)}function g(){const e=[...a.managers,...a.users,...a.readonlys].filter((e=>e.id!==l.id));new Tabulator("#usersTable",{layout:"fitDataTable",data:e,pagination:"local",paginationSize:15,columns:[{title:"Имя пользователя",field:"username",sorter:"string"},{title:"Логин",field:"login",sorter:"string"},{title:"Ник discord",field:"discord",sorter:"string"},{title:"E-mail",field:"email",sorter:"string"},{title:"Роль",field:"role",sorter:"string",formatter(e){const t=u[e._cell.row.data.id];return ae[t]}},{title:"",field:"id",formatter(e){const t=u[e._cell.row.data.id],l=document.createElement("button");return l.className="linkToRow",l.addEventListener("click",(()=>{m={...e._cell.row.data,role:t},f=t,n(1,s=""),function(){const e={fields:{role:{row:1,type:"select",label:"Выберете новую роль",options:c.filter((e=>e.value!==f)),required:!0},deleteUser:{type:"button",label:"или",value:"Удалите пользователя",color:"red",size:"sm",async onClick(e){const t=await(async(e,t,n)=>{const l={method:"DELETE",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({userId:e,fundId:t,prevRole:n})};try{return(await fetch(oe+"funds/deleteUser",l)).json()}catch(e){return e}})(m.id,a.id,f);e.fields.msg.value=t.msg||t,"OK"===t.status&&(delete u[m.id],await h(),g(),e.modal.closeModal())}},msg:{type:"html",value:""}},methods:{async onSubmit(e,t,n){const l=await(async(e,t,n,l)=>{const o={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({userId:e,role:t,fundId:l,prevRole:n})};try{return(await fetch(oe+"funds/updateUser",o)).json()}catch(e){return e}})(m.id,n.role,f,a.id);e.fields.msg.value=l.msg||l,"OK"===l.status&&(await h(),g())}},modal:!0,buttons:{submit:{label:"Обновить роль",color:"primary"}},title:"Редактирование пользователя "+m.username};window.callForm2("#userEditor",{},e)}()})),l.innerText="выбрать",l}}]})}async function h(){const e=await(async e=>{const t={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"funds/formatted?id="+e,t)).json()}catch(e){return e}})(o),t=await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"users/availible",e)).json()}catch(e){return e}})();if(t.data?.length&&t.data.forEach((e=>p.push({...e,name:e.username}))),"OK"===e.status)return n(2,a=e.data),a.owner?.value&&(u[a.owner.value]="owner"),a.managers.forEach((e=>u[e.value]="manager")),a.users.forEach((e=>u[e.value]="user")),a.readonlys.forEach((e=>u[e.value]="readonly")),a;n(1,s=e.msg||e)}async function y(e=0){return n(0,i=e),n(1,s=""),await(S(),C),0===e?b():1===e?function(){const e={title:"Добавить зарегистрированных участников",fields:{user:{label:"Пользователь",required:!0,hint:"Начните вводить имя пользователя",options:p,type:"select",onInput(e,t,n){const l=e.fields.user.options.find((e=>e.id===n));d=l}},role:{label:"Роль",options:c,type:"select",required:!0},msg:{type:"html",value:"",service:!0}},methods:{async onSubmit(e,t,n){if(u[n.user])return void(e.fields.msg.value="Пользователь уже добавлен, перейдите во вкладку редактирования");const l=await me(n.user,n.role,a.id);"OK"===l.status&&(a[n.role+"s"].push({label:d.name,value:d.id}),u[n.user]=n.role,await h()),e.fields.msg.value=l.msg||l}},buttons:{submit:{label:"Добавить",color:"primary"}}};window.callForm2("#addUsersForm",{},e)}()||function(){const e=[{id:"guest",name:"Обычный"}];"root"===l.role&&e.unshift({id:"root",name:"root"});const t={title:"Зарегистрировать и добавить участников",fields:{login:{label:"Логин"},name:{label:"Имя пользователя"},discord:{label:"Ник discord"},email:{label:"E-mail",type:"email",rules:[e=>0==e||Boolean(e.includes("@")&&e.includes("."))||"неверный формат e-mail"]},password:{label:"Пароль",type:"password",rules:[e=>e.length>5||"введите минимум 6 символов"],required:!0},role:{label:"Роль на сайте",type:"select",autocomplete:!1,options:e,value:"guest",visible:"root"===l.role,required:!0},groupRole:{label:"Роль в фонде",type:"select",options:[{name:"Менеджер",id:"manager"},{name:"Обычный",id:"user"},{name:"Только чтение",id:"readonly"}],required:!0},msg:{type:"html",value:"",service:!0}},methods:{async onSubmit(e,t,n){if(!n.login&&!n.discord&&!n.email)return void(e.fields.msg.value="Введите логин, или discord или email");const o={};for(const[e,t]of Object.entries(n))""!==t&&"groupRole"!==e&&(o[e]=t);const r=await Ee(o);if("OK"!==r.status)return!1;e.fields.msg.value=r.msg||r;const i=r.data;l.children.push(i.id);const s=await me(i.id,n.groupRole,a.id);"OK"===s.status&&(a[n.groupRole+"s"].push({label:i.name,value:i.id}),u[i.id]=n.groupRole,await h()),e.fields.msg.value=s.msg||s}},buttons:{submit:{label:"Создать и добавить",color:"primary"}}};window.callForm2("#regAndAddUsersForm",{},t)}():2===e?g():void 0}k((async()=>{await h()&&b()}));return[i,s,a,y,()=>y(0),()=>y(1),()=>y(2)]}class Ze extends B{constructor(e){super(),D(this,e,Xe,Ve,a,{})}}function et(t){let n;return{c(){n=m("div"),g(n,"id","createNoteForm")},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function tt(e,t,n){let l,o,a;r(e,Y,(e=>n(0,l=e))),r(e,ee,(e=>n(1,o=e))),r(e,V,(e=>n(2,a=e)));let i=[];function s(){const e={fields:{author:{label:"Создать от имени",type:"select",options:i,required:!0},case:{label:"Арбитраж",type:"multiple",value:[],settings:{arbitrage:{label:"Арбитраж",row:1},descr:{label:"Описание",type:"textarea",row:1},amount:{label:"Размер",row:1}}},nickname:{label:"Дисциплины",type:"multiple",value:[],settings:{discipline:{label:"Дисциплина",row:1},room:{label:"Room",row:1},value:{label:"Nick",row:1}}},horizont:{type:"html",value:'<div class="filler"/>'},nicknameOld:{label:"Архивные значения",type:"textarea",visible:!1},FIO:{label:"ФИО",type:"multiple",value:[],settings:{firstname:{label:"Имя",row:1},lastname:{label:"Фамилия",row:1},middlename:{label:"Отчество",row:1}}},horizont2:{type:"html",value:'<hr class="q-ma-none q-pa-none"/>'},htmlHint:{type:"html",value:"Добавляйте значения при помощи клавиши 'enter'"},gipsyteam:{label:"Gipsy team",type:"creatable",outlined:!0},skype:{label:"Аккаунты Skype",type:"creatable",outlined:!0},skrill:{label:"Аккаунты skrill",type:"creatable",outlined:!0},neteller:{label:"Аккаунты neteller",type:"creatable",outlined:!0},phone:{label:"Телефоны",type:"creatable",outlined:!0},pokerstrategy:{label:"Poker Strategy",type:"creatable",outlined:!0},google:{label:"Google аккаунты",type:"creatable",outlined:!0},mail:{label:"Адреса e-mail",type:"creatable",outlined:!0},vk:{label:"Аккаунты vkontakte",type:"creatable",outlined:!0},facebook:{label:"Аккаунты facebook",type:"creatable",outlined:!0},blog:{label:"Блоги",type:"creatable",outlined:!0},instagram:{label:"Аккаунты instagram",type:"creatable",outlined:!0},forum:{label:"Форумы",type:"creatable",outlined:!0},ecopayz:{label:"Аккаунты ecopayz",type:"creatable",outlined:!0},location:{label:"Адреса",type:"multiple",value:[],settings:{country:{label:"Страна",row:1},town:{label:"Город",row:1},address:{label:"Адрес",row:1}}},webmoney:{label:"Аккаунты Webmoney",type:"multiple",value:[],settings:{WMID:{row:1,label:"WMID",required:!0},wallets:{label:"Кошельки",type:"creatable",row:1}}},comments:{label:"Комментарии",type:"textarea"},msg:{type:"html",value:""}},methods:{async onSubmit(e,t,n){e.fields.msg.value="";const l={};for(const[e,t]of Object.entries({...n}))""!==t&&(l[e]=t);const o=await async function(e){const t={method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({...e})};try{return(await fetch(oe+"table/create",t)).json()}catch(e){return e}}(l);e.fields.msg.value=o.msg}},title:"Создать запись о репутации игрока"};window.callForm2("#createNoteForm",{},e)}return k((async()=>{if("root"===l.role)return Object.entries(o).forEach((([e,t])=>i.push({id:e,name:t}))),s();for(const[e,t]of Object.entries(a))"owner"!==t&&"manager"!==t&&"user"!==t||i.push({id:e,name:o[e]});s()})),[]}class nt extends B{constructor(e){super(),D(this,e,tt,et,a,{})}}function lt(e){let t;return{c(){t=f(e[0])},m(e,n){u(e,t,n)},p(e,n){1&n&&h(t,e[0])},d(e){e&&d(t)}}}function ot(t){let n,l,o=t[0]&&lt(t);return{c(){o&&o.c(),n=p(),l=m("div"),g(l,"id","createNoteForm")},m(e,t){o&&o.m(e,t),u(e,n,t),u(e,l,t)},p(e,[t]){e[0]?o?o.p(e,t):(o=lt(e),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){o&&o.d(e),e&&d(n),e&&d(l)}}}function at(e,t,n){let l,o;r(e,Y,(e=>n(1,l=e))),r(e,ee,(e=>n(2,o=e)));let a=[],i="";const s=new URLSearchParams(window.location.search),c=s.get("id"),u=s.get("parent");function d(e){const t={fields:{author:{label:"Автор",type:"select",options:a,required:!0,readonly:"root"!==l.role},case:{label:"Арбитраж",type:"multiple",value:[],settings:{arbitrage:{label:"Арбитраж",row:1},descr:{label:"Описание",type:"textarea",row:1},amount:{label:"Размер",row:1}}},nicknameOld:{label:"Архивные дицсциплины и никнеймы",hint:'Поскольку данная версия записи является архивной, вы можете редактировать текущее поле или использовать блок "Дисциплины"',type:"textarea",visible:Boolean(e.nicknameOld)},nickname:{label:"Дисциплины",type:"multiple",value:[],settings:{discipline:{label:"Дисциплина",row:1},room:{label:"Room",row:1},value:{label:"Nick",row:1}}},horizont:{type:"html",value:'<div class="filler"/>'},FIO:{label:"ФИО",type:"multiple",value:[],settings:{firstname:{label:"Имя",row:1},lastname:{label:"Фамилия",row:1},middlename:{label:"Отчество",row:1}}},horizont2:{type:"html",value:'<hr class="q-ma-none q-pa-none"/>'},htmlHint:{type:"html",value:"Добавляйте значения при помощи клавиши 'enter'"},gipsyteam:{label:"Gipsy team",type:"creatable",outlined:!0},skype:{label:"Аккаунты Skype",type:"creatable",outlined:!0},skrill:{label:"Аккаунты skrill",type:"creatable",outlined:!0},neteller:{label:"Аккаунты neteller",type:"creatable",outlined:!0},phone:{label:"Телефоны",type:"creatable",outlined:!0},pokerstrategy:{label:"Poker Strategy",type:"creatable",outlined:!0},google:{label:"Google аккаунты",type:"creatable",outlined:!0},mail:{label:"Адреса e-mail",type:"creatable",outlined:!0},vk:{label:"Аккаунты vkontakte",type:"creatable",outlined:!0},facebook:{label:"Аккаунты facebook",type:"creatable",outlined:!0},blog:{label:"Блоги",type:"creatable",outlined:!0},instagram:{label:"Аккаунты instagram",type:"creatable",outlined:!0},forum:{label:"Форумы",type:"creatable",outlined:!0},ecopayz:{label:"Аккаунты ecopayz",type:"creatable",outlined:!0},location:{label:"Адреса",type:"multiple",value:[],settings:{country:{label:"Страна",row:1},town:{label:"Город",row:1},address:{label:"Адрес",row:1}}},webmoney:{label:"Аккаунты Webmoney",type:"multiple",value:[],settings:{WMID:{row:1,label:"WMID",required:!0},wallets:{label:"Кошельки",type:"creatable",row:1}}},comments:{label:"Комментарии",type:"textarea"},old:{type:"checkbox",label:"Архивная запись",hint:"снимите флажок, если запись была отредактирована в новый формат"},delButton:{value:"Удалить запись",type:"button",visible:"root"===l.role,color:"red",async onClick(e){const t=await(async e=>{const t={method:"DELETE",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"table/note?id="+e,t)).json()}catch(e){return e}})(c);e.fields.msg.value=t.msg||t}},msg:{type:"html",value:""}},methods:{async onSubmit(e,t,n){e.fields.msg.value="";const l={};for(const[e,t]of Object.entries({...n}))""!==t&&(l[e]=t);const o=await async function(e,t){const n={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({data:e,id:t})};try{return(await fetch(oe+"table/update",n)).json()}catch(e){return e}}(l,u||c);e.fields.msg.value=o.msg}},title:"Редактировать запись о репутации игрока",buttons:{submit:{label:"Обновить",color:"primary"}}};u&&(t.title="Редактировать запись из архива",delete t.fields.delButton,delete t.fields.old),window.callForm2("#createNoteForm",e,t)}return k((async()=>{let e;if(e=u?await(async e=>{const t={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"table/archiveNote?id="+e,t)).json()}catch(e){return e}})(c):await(async e=>{const t={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"table/note?id="+e,t)).json()}catch(e){return e}})(c),"OK"!==e.status)return n(0,i=e.msg||e);Object.entries(o).forEach((([e,t])=>a.push({id:e,name:t}))),d(e.data)})),[i]}class rt extends B{constructor(e){super(),D(this,e,at,ot,a,{})}}function it(t){let n;return{c(){n=m("div"),g(n,"id","userEditForm")},m(e,t){u(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function st(e,t,n){let l;r(e,Y,(e=>n(0,l=e)));const o={fields:{username:{label:"Имя пользователя",hint:"Как к вам обращаться"},login:{label:"Логин"},discord:{label:"Ник discord"},email:{label:"E-mail",type:"email",rules:[e=>0==e||Boolean(e.includes("@")&&e.includes("."))||"неверный формат e-mail"]},password:{label:"Новый пароль",type:"password"},msg:{type:"html",value:""}},methods:{async onSubmit(e,t,n){const o=e.fields.msg;if(!n.login&&!n.discord&&!n.email)return void(o.value="Введите логин, или discord или email");const a={};for(const[e,t]of Object.entries(n))""!==t&&(a[e]=t);const r=await(async e=>{const t={method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({...e})};try{return(await fetch(oe+"auth/updateCreds/",t)).json()}catch(e){return e}})(a);"OK"===r.status&&s(Y,l={...l,...r.data},l),o.value=r.msg}}};return k((()=>{window.callForm2("#userEditForm",l,o)})),[]}class ct extends B{constructor(e){super(),D(this,e,st,it,a,{})}}function ut(t){let n;return{c(){n=f("404")},m(e,t){u(e,n,t)},i:e,o:e,d(e){e&&d(n)}}}function dt(e){let t,n;return t=new Se({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function mt(e){let t,n;return t=new ct({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function ft(e){let t,n;return t=new Be({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function pt(e){let t,n;return t=new Le({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function bt(e){let t,n;return t=new rt({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function gt(e){let t,n;return t=new Ze({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function ht(e){let t,n;return t=new Me({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function yt(e){let t,n;return t=new nt({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function wt(e){let t,n;return t=new qe({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function vt(e){let t,n;return t=new ge({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function $t(e){let t,n;return t=new we({}),{c(){M(t.$$.fragment)},m(e,l){K(t,e,l),n=!0},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function kt(t){let n;return{c(){n=f("Loading...")},m(e,t){u(e,n,t)},i:e,o:e,d(e){e&&d(n)}}}function Ot(e){let t,n,l,o,a,r,i,s;n=new de({});const f=[kt,$t,vt,wt,yt,ht,gt,bt,pt,ft,mt,dt,ut],b=[];function h(e,t){return e[0]?e[1].role?"/createFund"===e[2]?2:"/createUser"===e[2]?3:"/createNote"===e[2]?4:"/editUser"===e[2]?5:"/editFund"===e[2]?6:"/editNote"===e[2]?7:"/users"===e[2]?8:"/funds"===e[2]?9:"/settings"===e[2]?10:"/"===e[2]?11:12:1:0}return r=h(e),i=b[r]=f[r](e),{c(){t=m("main"),M(n.$$.fragment),l=p(),o=m("div"),a=p(),i.c(),g(o,"class","navFiller svelte-1wxzo8x")},m(e,i){u(e,t,i),K(n,t,null),c(t,l),c(t,o),c(t,a),b[r].m(t,null),s=!0},p(e,[n]){let l=r;r=h(e),r!==l&&(U(),G(b[l],1,1,(()=>{b[l]=null})),q(),i=b[r],i||(i=b[r]=f[r](e),i.c()),z(i,1),i.m(t,null))},i(e){s||(z(n.$$.fragment,e),z(i),s=!0)},o(e){G(n.$$.fragment,e),G(i),s=!1},d(e){e&&d(t),R(n),b[r].d()}}}function jt(e,t,n){let l,o;r(e,Y,(e=>n(1,l=e))),r(e,H,(e=>n(2,o=e)));let a=!1;return async function(){const e=await(async()=>{const e={method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};try{return(await fetch(oe+"auth/refresh",e)).json()}catch(e){return e}})();if(n(0,a=!0),e.status="OK"){e.data.userProps?.funds&&V.set(e.data.userProps.funds);const t={};return e.data.fundNames.length&&e.data.fundNames.forEach((({id:e,name:n})=>t[e]=n)),ee.set(t),s(Y,l=e.data.user,l),void(e.data.userProps?.children&&s(Y,l.children=e.data.userProps.children,l))}Q("/login")}(),H.set(window.location.pathname),window.onpopstate=function(e){H.set("/"+e.state)},[a,l,o]}return new class extends B{constructor(e){super(),D(this,e,jt,Ot,a,{})}}({target:document.getElementById("sveltePoint")})}();
